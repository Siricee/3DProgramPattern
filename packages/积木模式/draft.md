一切皆可搭建
# 引入故事，提出问题

- 引入故事
    - 描述故事
<!-- 如何让每个人独立地开发引擎的功能点 -->
<!-- 两个开发者同时开发引擎的不同功能点，其中开发者甲负责实现 -->
<!-- 三个开发者同时开发引擎的不同功能点，其中甲负责实现场景，乙负责实现渲染，丙富足实现基础库（如数学库） -->

甲想要从0实现一个3D引擎
<!-- 他首先实现了一个引擎的Demo，直接使用WebGL绘制出了一个最简单的场景，了解了一个引擎包含哪些基本的功能点 -->
他首先实现了一个引擎的Demo，直接使用WebGL绘制出了一个最简单的场景
<!-- 然后他选择首先实现一个数学库，它包括矩阵计算之类的逻辑 -->
然后他从Demo中提炼出了引擎的最基本的框架，包括初始化、主循环的逻辑

    - 给出代码

    - 给出UML

- 提出问题


甲发现一个人开发引擎的话花的时间太久了，于是找了另外三个开发者乙、丙、丁一起来开发

<!-- 如何让每个人独立地开发引擎的功能点，将互相之间的影响降到最低？ -->


# 主问题：给出直接的解决方案

- 请给出直接的解决方案?
    - 概述解决方案
<!-- 甲负责实现实现一个数学库，它包括矩阵计算之类的逻辑； -->
甲继续开发Director，完善初始化、主循环的逻辑；
乙负责实现实现一个数学库，它包括矩阵计算之类的逻辑；
丙负责实现管理3D场景；
丁负责实现渲染

    - 给出UML
TODO tu

Engine需要暴露初始化、主循环和管理场景的API，因此需要依赖Director、SceneManager；
Director需要在初始化时初始化场景和渲染，并在主循环时更新场景和进行渲染，因此需要依赖SceneManager、Render；
Render需要场景数据，因此需要依赖SceneManager；
SceneManager、Render需要进行数学计算，所以需要依赖Math

    - 给出代码

    <!-- - 结合UML图，描述如何具体地解决问题 -->


# 主问题：分析存在的问题

- 请分析存在的问题?
因为这四个人实现的功能点有互相依赖的关系，所以会出现下面的情况：
<!-- 合并代码时，出现大量冲突； -->
<!-- 多人 -->
一个人修改了自己的代码，会影响到其他人的代码；
一个人可能需要修改别人负责的功能点代码，造成冲突。比如实现Render的丁可能会修改SceneManager的代码，使其能提供某些特定的场景数据，结果在合并代码时发现丙实现的SceneManager提供的是其它的数据
<!-- 它并没有提供； -->

这样就导致了开发效率的降低和沟通成本的增加

- 提出改进方向？

1.如何让每个人独立地开发引擎的功能点，将互相之间的影响降到最低，从而能通过增加引擎的开发人员来实现加快引擎的开发进度？
2.如何将引擎模块化，使得引擎只包含Client需要的引擎模块，去除其它的引擎模块，从而减少引擎的文件大小



# 主问题：给出可能的改进方案

- 请给出可能的改进方案?
    - 概述解决方案
    - 给出UML ？
    - 给出代码
    - 结合UML图，描述如何具体地解决问题

<!-- 再增加一个开发者，开发渲染 -->


# 主问题：给出使用模式的改进方案

- 请给出使用模式的改进方案?
    - 概述解决方案
<!-- 只要解除编辑器和具体的引擎的依赖，并把引擎升级或替换的逻辑隔离出去就可以！新设计的类图如下所示： -->
将每个功能点划分为独立的积木，并定义该积木的协议，使得这样每个功能点相互之间依赖的是抽象的积木协议而不是具体的积木实现
其中积木协议定义了提供的服务的接口和包含的数据的类型

再加入一个BlockManager，用于管理积木



    - 遵循哪些设计原则
    - 给出UML
    - 给出代码

    - 结合UML图，描述如何具体地解决问题

    TODO why need dependentBlockProtocolNameMap?

只要协议不变，也就是ServiceType->service->getAllGameObjects类型不变，那么修改SceneManager Block->getAllGameObjects并不会影响Render Block；
同理，只要协议不变，也就是ServiceType->service->multiplyMatrix类型不变，那么修改Math Block->multiplyMatrix并不会影响SceneManager Block和Render Block；


# 主问题：提出模式


- 设计意图？
- 定义
    - 一句话定义
    - 描述定义？
    - 通用UML
    - 分析角色
    - 角色之间的关系
    - 角色的抽象代码
    - 遵循的设计原则在UML中的体现


- 应用
    - 优点？
方便测试

    - 缺点？
    - 使用场景
    - 描述场景？
    - 实现该场景需要修改模式的哪些角色？
    - 使用模式有什么好处？
    - 注意事项？

- 扩展
    - 如何扩展、推广、发散？
    使用dependent type检查协议?

    <!-- 2.使用契约检查协议? -->

    对积木进行扩展




    <!-- config -->



    <!-- TODO 结合钩子函数 -->
    init/update Block

    <!-- TODO 结合单文件模式 -->
    binary file


- 结合其它模式
    - 结合哪些模式？

    - 使用场景是什么？
    - UML如何变化？
    - 代码如何变化？


# 主问题：最佳实践

- 结合具体项目实践经验，如何应用模式来改进项目？
    - 哪些场景不需要使用模式
    - 哪些场景需要使用模式？
    - 给出具体的实践案例


# 主问题：推荐更多资料

- 推荐更多资料？


TODO rescript 代码版本
TODO typescript 代码版本