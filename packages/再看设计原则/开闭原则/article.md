# 定义

对扩展开放，对修改关闭


# 补充说明

一个软件实体应该通过扩展来实现变化，而不是通过修改已有的代码来实现变化


<!-- # 做项目的时候哪些地方违反了开闭原则？ -->

具体来说，如果我们为了增加第三方库的功能而直接修改第三方库的代码，那么这就违反了开闭原则

**为什么违反**
这是通过修改了已有代码来实现变化

**造成什么问题**
升级第三方库的版本时，会导致原有的修改失效，从而不得不再次修改一遍


**如何改进**

有很多改进的方法，其中一个方法就是使用设计模式中的“中间者模式”，增加一个模块A来封装第三方库，让用户改为调用模块A而不是直接调用第三方库。
这样在需要增加第三方库的功能时，则只增加一个模块B，使其继承模块A，然后在模块B中加入增加的功能代码，让用户改为调用模块B

这样做的话就通过扩展而不是修改来实现了变化，从而符合开闭原则


# 案例1

以服装店销售衣服系统为例，领域模型如下：
TODO tu


现在需要对TShirt中所有40元以上的衣服9折销售，有下面三种实现的思路如下：

- 修改用户模块ClothStore
在卖衣服时判断价格来打对应的折扣
- 修改接口Cloth
首先，Cloth增加一个函数：getOffPrice()，专门用于进行打折处理；
然后，TShirt实现该函数；
最后，ClothStore从调用getPrice函数改为调用getOffPrice函数
- 修改实现模块TShirt
修改TShirt的getPrice函数，实现打折处理

上面三种实现思路都违反了开闭原则，因为它们都是通过修改Cloth的相关代码来实现变化

我们可以增加一个继承TShirt的子模块：OffTShirt，在其中增加getOffPrice函数
领域模型如下：
TODO tu

这样就只需要修改用户模块ClothStore，使其从调用TShirt的getPrice函数改为调用OffTShirt的getOffPrice函数，而不需要修改Cloth的相关代码

这样就通过扩展来实现了变化，符合开闭原则

值得注意的是：开闭原则允许修改用户模块


# 案例2


我们来看下另一个例子，我们要实现一个人员管理系统，领域模型如下：
TODO tu

人员固定有三个数据：姓名、卡号、部门

现在用户提出了新的需求，希望能够任意地新增、修改、删除人员的数据，那么系统应该如何设计，才能实现用户的需求且符合开闭原则？



我们修改领域模型，修改后如下：
TODO tu

这里将人员和它的数据改为了组合关系
比如对于原来的三个数据，现在它们的关系如下：
```ts
人员 = 人员数据项1 + 人员数据项2 + 人员数据项3

其中：
人员数据项1 = 名称(姓名) + 值 + 类型(string)
人员数据项2 = 名称(卡号) + 值 + 类型(string)
人员数据项3 = 名称(部门) + 值 + 类型(string)
```

可以通过增加一个人员数据项，从而实现增加一个人员的数据；
可以通过增加一个修改后的人员数据项，并使人员从组合修改前的数据项改为组合修改后的数据项，从而实现修改人员的数据；
可以通过使人员不再组合某个数据项，从而实现删除人员的数据

这些都是通过扩展而非修改来实现变化，所以符合开闭原则